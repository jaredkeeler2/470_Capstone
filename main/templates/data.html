{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Course Data</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <style>
        body { font-family: Arial; margin: 30px; background: #f9f9f9; }
        h1 { color: #333; }
        table { border-collapse: collapse; width: 100%; background: #fff; margin-top: 20px; }
        th, td { padding: 8px 10px; border: 1px solid #ccc; text-align: left; }
        th { background: #e0e0e0; }
        button { background: #007bff; border: none; padding: 8px 12px; color: white; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .msg { padding: 10px; background: #e7f3ff; border-left: 5px solid #2196F3; margin-bottom: 10px; }
        .error { padding: 10px; background: #ffe7e7; border-left: 5px solid #f44336; margin-bottom: 10px; }
        .section { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h1>Course Data</h1>

    <!-- Navigation Buttons -->
    <p>
        <a href="{% if URL_PREFIX %}/{{ URL_PREFIX }}/{% else %}/{% endif %}"><button>Back to Dashboard</button></a>
        <a href="{% url 'download_data' %}"><button>Download CSV</button></a>
    </p>

    <!-- Upload CSV Form -->
    <div class="section">
        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <label>Upload CSV:</label>
            <input type="password" name="upload_password" placeholder="Upload Password" required>
            <input type="file" name="csv_file" accept=".csv" required>
            <button type="submit">Upload</button>
        </form>
    </div>

    <!-- Messages -->
    {% if message %}<div class="msg">{{ message }}</div>{% endif %}
    {% if error %}<div class="error">{{ error }}</div>{% endif %}

    <hr>

    <!-- Full Remove & Rescrape Button -->
    <div class="section">
        <form method="POST" action="{% url 'rescrape_data' %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" onclick="return confirmRescrape();">
                Rescrape All Courses
            </button>
        </form>
    </div>

    <!-- Courses Pivot Table -->
    <h3>All Courses</h3>
    <table>
        <tr>
            <th>Code</th>
            <th>Title</th>
            {% for term in all_terms %}
                <th>{{ term }}</th>
            {% endfor %}
        </tr>

        {% for code, course in courses_dict.items %}
            <tr>
                <td>{{ code }}</td>
                <td>{{ course.title }}</td>
                {% for enrolled in course.enrolled_list %}
                    <td>{{ enrolled }}</td>
                {% endfor %}
            </tr>
        {% endfor %}
    </table>

    <!-- Confirmation Script -->
    <script>
        function confirmRescrape() {
            return confirm(
                "Are you sure you want to remove all courses data and rescrape?"
            );
        }
    </script>
</body>
</html>
